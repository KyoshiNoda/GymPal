import type {GetServerSidePropsContext, NextPage} from 'next'
import Head from 'next/head'
import {useSession, signIn, signOut} from 'next-auth/react'
import Link from 'next/link'

import {getServerAuthSession} from 'src/server/common/get-server-auth-session'
import Theme from 'src/components/theme'

const Home: NextPage = () => {
	const {data: session} = useSession()

	return (
		<>
			<Head>
				<title>Gym Pal</title>
				<meta name='description' content='Generated by create-t3-app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>

			<main className='container mx-auto p-4'>
				<Theme />
				<h1 className='text-center text-4xl font-bold'>Hello Gym Pal</h1>
				{session ? (
					<div className='flex flex-col items-center justify-around gap-4'>
						<div className='flex flex-col gap-4'>
							<p>Logged in as {session?.user?.email}</p>
							<button
								onClick={() => signOut()}
								className='rounded border border-black p-4'
							>
								Logout
							</button>
						</div>
						<div className='flex items-center gap-4'>
							<Link href='/workout'>
								<p className='cursor-pointer rounded border-2 border-gray-400 p-2'>
									Workout
								</p>
							</Link>
							<Link href='/user'>
								<p className='cursor-pointer rounded border-2 border-gray-400 p-2'>
									User
								</p>
							</Link>
							<Link href='logout'>
								<p className='cursor-pointer rounded border-2 border-gray-400 p-2'>
									Logout
								</p>
							</Link>
						</div>
					</div>
				) : (
					<div>
						<p>Not signed in</p>
						<button
							onClick={() =>
								signIn('discord', {
									callbackUrl: `/`,
								})
							}
							className='rounded border border-black p-4'
						>
							Discord
						</button>
					</div>
				)}
			</main>
		</>
	)
}

export default Home

export const getServerSideProps = async (ctx: GetServerSidePropsContext) => {
	return {
		props: {
			session: await getServerAuthSession(ctx),
		},
	}
}
